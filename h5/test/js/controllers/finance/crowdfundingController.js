define("bannerModel",[],function(){var e=Backbone.Model.extend({url:Mayfle.mayfleApi+"rest/v2.0/base/banners"});return e}),define("crowdfundingModel",[],function(){var e=Backbone.Model.extend({url:Mayfle.xiaodouApi+"product/crowd"});return e}),define("caseModel",[],function(){var e=Backbone.Model.extend({url:Mayfle.xiaodouApi+"rest/v2.0/base/banners",defaults:{discountInfoId:0}});return e}),define("widget",[],function(){var e={bannerSlider:function(){var e=new fz.Scroll(".ui-slider",{role:"slider",indicator:!0,autoplay:!0,interval:3e3})}};return e}),define("appAgent",[],function(){var e={ua:navigator.userAgent.toLowerCase(),customProtocol:"mayfle://",isWeixinBrowser:function(){return/micromessenger/.test(this.ua)},isApple:function(){return/iphone|ipad|ipod/.test(this.ua)},isAndroid:function(){return/android/.test(this.ua)},isMayfle:function(){return/mayfle/.test(this.ua)}};return e}),define("utility",["appAgent"],function(e){var t={getCity:function(){return e.isMayfle()?mayfleJS.getCity():""},getLonLat:function(){if(e.isMayfle()){var t=mayfleJS.getLonLat(),n=t.split(",")[0],r=t.split(",")[1];return new Array(n,r)}if(navigator.geolocation)return[200,200]},getToken:function(t){if(e.isMayfle())return mayfleJS.requestToken(t)},login:function(t){if(e.isMayfle())return mayfleJS.nativeLogin(t)},formatNumber:function(e){return e=e.toString(),e.length<=3?e:arguments.callee(e.substr(0,e.length-3))+","+e.substr(e.length-3)},getTarget:function(e,t){var n=e.target,r="",i=t&&t.elem?t.elem:"a";return n.nodeName!==i.toUpperCase()?r=$(n).closest(i):r=$(n),r},jumpTo:function(t){var n=this,r=t&&t.url?t.url:"",i=t&&t.host?Mayfle.H5BaseUrl:"",s=t.targetModel?t.targetModel:"h5";e.isMayfle()?s=="native"?r.length>1?r=e.customProtocol+r[1]:r=e.customProtocol+r[0]:r=i+r[0]:r=i+r[0];var o=t.title&&(r.indexOf("?")>0?"&":"?")+"title="+encodeURI(t.title)||"";e.isMayfle()&&e.isApple()&&s=="native"?window.location.hash=r+o:location.href=r+o},scoreToStar:function(e){var t;return e%1==0?t=e:e%1<.3?t=Math.floor(e):e%1>.7?t=Math.round(e):t=Math.floor(e)+"f","star-"+t},addLoading:function(){$(".ui-loading-wrap").length?$(".ui-loading-wrap").html('<p>加载中</p><i class="ui-loading"></i>'):$("body").append('<div class="ui-loading-wrap"><p>加载中</p><i class="ui-loading"></i></div>')},removeLoading:function(){$(".ui-loading-wrap").remove()},noMoreData:function(e){$(".ui-loading-wrap").html(e||"亲，没有更多的数据了！")},fullScreenLoading:"",addFullScreenLoading:function(e){this.fullScreenLoading=$.loading({content:e||"加载中..."})},removeFullScreenLoading:function(){this.fullScreenLoading.loading("hide")},errorMessage:function(){$("body").html('<p style="padding:20px 10px; text-align:center;font-size:16px;">程序员哥哥正在抢修中，请稍后再试！</p>')}};return t}),function(e){e.Callbacks=function(t){t=e.extend({},t);var n,r,i,s,o,u,a=[],f=!t.once&&[],l=function(e){n=t.memory&&e,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;++u)if(a[u].apply(e[0],e[1])===!1&&t.stopOnFalse){n=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):n?a.length=0:c.disable())},c={add:function(){if(a){var r=a.length,u=function(n){e.each(n,function(e,n){typeof n=="function"?(!t.unique||!c.has(n))&&a.push(n):n&&n.length&&typeof n!="string"&&u(n)})};u(arguments),i?o=a.length:n&&(s=r,l(n))}return this},remove:function(){return a&&e.each(arguments,function(t,n){var r;while((r=e.inArray(n,a,r))>-1)a.splice(r,1),i&&(r<=o&&--o,r<=u&&--u)}),this},has:function(t){return!!a&&!!(t?e.inArray(t,a)>-1:a.length)},empty:function(){return o=a.length=0,this},disable:function(){return a=f=n=undefined,this},disabled:function(){return!a},lock:function(){return f=undefined,n||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return a&&(!r||f)&&(t=t||[],t=[e,t.slice?t.slice():t],i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments)},fired:function(){return!!r}};return c}}(Zepto),define("callback",function(){}),function(e){function n(t){var r=[["resolve","done",e.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",e.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",e.Callbacks({memory:1})]],i="pending",s={state:function(){return i},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var t=arguments;return n(function(n){e.each(r,function(r,i){var u=e.isFunction(t[r])&&t[r];o[i[1]](function(){var t=u&&u.apply(this,arguments);if(t&&e.isFunction(t.promise))t.promise().done(n.resolve).fail(n.reject).progress(n.notify);else{var r=this===s?n.promise():this,o=u?[t]:arguments;n[i[0]+"With"](r,o)}})}),t=null}).promise()},promise:function(t){return t!=null?e.extend(t,s):s}},o={};return e.each(r,function(e,t){var n=t[2],u=t[3];s[t[1]]=n.add,u&&n.add(function(){i=u},r[e^1][2].disable,r[2][2].lock),o[t[0]]=function(){return o[t[0]+"With"](this===o?s:this,arguments),this},o[t[0]+"With"]=n.fireWith}),s.promise(o),t&&t.call(o,o),o}var t=Array.prototype.slice;e.when=function(r){var i=t.call(arguments),s=i.length,o=0,u=s!==1||r&&e.isFunction(r.promise)?s:0,a=u===1?r:n(),f,l,c,h=function(e,n,r){return function(i){n[e]=this,r[e]=arguments.length>1?t.call(arguments):i,r===f?a.notifyWith(n,r):--u||a.resolveWith(n,r)}};if(s>1){f=new Array(s),l=new Array(s),c=new Array(s);for(;o<s;++o)i[o]&&e.isFunction(i[o].promise)?i[o].promise().done(h(o,c,i)).fail(a.reject).progress(h(o,l,f)):--u}return u||a.resolveWith(c,i),a.promise()},e.Deferred=n}(Zepto),define("deferred",["callback"],function(){}),define("crowdfundingController",["bannerModel","crowdfundingModel","caseModel","widget","utility","deferred"],function(e,t,n,r,i){var s=Backbone.View.extend({el:$(".crowdfunding"),bannerModel:new e,crowdfundingModel:new t,caseModel:new n,bannerTemplate:_.template($("#bannerTemplate").html()),crowdfundingTemplate:_.template($("#crowdfundingTemplate").html()),caseTemplate:_.template($("#caseTemplate").html()),events:{"tap .current":"toBannerDetail","tap .nav-tab":"tab","tap .show-more-product":"showMore","tap .toCrowdfundingDetail":"toDetail","tap .ui-border-t":"toCaseDetail"},initialize:function(){var e=this,t=$.Deferred(),n=$.Deferred(),i=$.Deferred();e.bannerModel.fetch({data:{module:3},success:function(t){e.$el.find("#banner").append(e.bannerTemplate(t.toJSON())),r.bannerSlider()}}),function(){e.crowdfundingModel.fetch({data:{start:0,limit:2,news:""},success:function(e){t.resolve(e.toJSON())}})}(),function(){e.crowdfundingModel.fetch({data:{start:0,limit:2,preheat:""},success:function(e){n.resolve(e.toJSON())}})}(),function(){e.crowdfundingModel.fetch({data:{start:0,limit:2,hot:""},success:function(e){i.resolve(e.toJSON())}})}(),$.when(t,n,i).done(function(t,n,r){var i={datas:t,index:1},s={datas:n,index:2},o={datas:r,index:3};e.$el.find(".content1").prepend(e.crowdfundingTemplate(i)),e.$el.find(".content2").prepend(e.crowdfundingTemplate(s)),e.$el.find(".content3").prepend(e.crowdfundingTemplate(o))}),e.crowdfundingModel.fetch({data:{"case":""},success:function(t){e.$el.find("#case").append(e.caseTemplate(t.toJSON()))}})},toBannerDetail:function(e){var t=i.getTarget(e,{elem:"li"}),n=$(t).attr("data-type"),r=$(t).attr("data-target");if($(t).attr("data-url")=="")var s="Null";else var s=$(t).attr("data-url");var o=$(t).attr("data-ptype"),u="webapp/banner/target.html?ptype="+o+"&target="+r+"&type="+n+"&url="+s;i.jumpTo({url:[u],host:!0,targetModel:"native"})},tab:function(e){var t=i.getTarget(e,{elem:"li"});$(t).addClass("current").siblings().removeClass("current");var n=$(".nav-tab"),r=n.index(t);$(".ui-tab-content>li").eq(r).addClass("display-block").siblings().removeClass("display-block")},showMore:function(e){var t=i.getTarget(e,{elem:"div"}),n=this,r=$(t).attr("data-index"),s=10;switch(r){case"1":t.count=$(t).attr("data-count"),t.count++,$(t).attr("data-count",t.count);var o=$(t).attr("data-count"),u=s*(o-1);this.crowdfundingModel.fetch({data:{start:u,limit:s,news:""},success:function(e){var r=e.toJSON(),i={datas:r,index:1};$(".crowdfunding").find(".content1").html(n.crowdfundingTemplate(i)),r.items.length<10&&($(t).html("没有更多数据了"),$.tips({content:"没有更多数据了",stayTime:2e3,type:"warn"}))},error:function(){$.tips({content:"出现错误,请稍后重试",stayTime:2e3,type:"warn"})}});break;case"2":t.count=$(t).attr("data-count"),t.count++,$(t).attr("data-count",t.count);var o=$(t).attr("data-count"),u=s*(o-1);this.crowdfundingModel.fetch({data:{start:u,limit:s,news:""},success:function(e){var r=e.toJSON(),i={datas:r,index:2};$(".crowdfunding").find(".content2").html(n.crowdfundingTemplate(i)),r.items.length<10&&($(t).html("没有更多数据了"),$.tips({content:"没有更多数据了",stayTime:2e3,type:"warn"}))},error:function(){$.tips({content:"出现错误,请稍后重试",stayTime:2e3,type:"warn"})}});break;case"3":t.count=$(t).attr("data-count"),t.count++,$(t).attr("data-count",t.count);var o=$(t).attr("data-count"),u=s*(o-1);this.crowdfundingModel.fetch({data:{start:u,limit:s,news:""},success:function(e){var r=e.toJSON(),i={datas:r,index:3};$(".crowdfunding").find(".content3").html(n.crowdfundingTemplate(i)),r.items.length<10&&($(t).html("没有更多数据了"),$.tips({content:"没有更多数据了",stayTime:2e3,type:"warn"}))},error:function(){$.tips({content:"出现错误,请稍后重试",stayTime:2e3,type:"warn"})}})}},toDetail:function(e){var t=i.getTarget(e,{elem:"a"}),n=$(t).attr("data-id"),r="webapp/finance/crowdfundingDetail.html?id="+n;i.jumpTo({url:[r],host:!0,targetModel:"h5"})},toCaseDetail:function(e){var t=i.getTarget(e,{elem:"li"}),n=$(t).attr("data-id"),r="webapp/finance/crowdfundingDetail.html?id="+n;i.jumpTo({url:[r],host:!0,targetModel:"h5"})}});return new s});